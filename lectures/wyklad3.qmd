---
title:  WykÅ‚ad 3
format:
  html:
    code-fold: true
jupyter: python3
---

â³ Czas trwania: 1,5h
*ğŸ¯ Cel wykÅ‚adu* 

zrozumienie, podstawowych sposobÃ³w przetwarzania i analizowania danych strumieniowych.

---

# Strumienie danych

Strumieniowanie moÅ¼esz kojarzyÄ‡ z serwisÃ³w przesyÅ‚ajÄ…cych wideo online. Gdy oglÄ…dasz swÃ³j ulubiony serial (tak jak teraz na zajÄ™ciach), platforma streamingowa w sposÃ³b nieprzerwany dostarcza do Ciebie kolejne â€porcjeâ€ wideo.

Podobna koncepcja dotyczy danych strumieniowych. PrzesyÅ‚ane porcje nie muszÄ… mieÄ‡ formatu wideo â€“ wszystko zaleÅ¼y od celu biznesowego. PrzykÅ‚adem moÅ¼e byÄ‡ ciÄ…gÅ‚y pomiar z czujnikÃ³w w fabrykach, elektrowniach czy innych systemach monitorujÄ…cych.

Kluczowe jest to, Å¼e masz do czynienia z nieprzerwanym strumieniem danych, ktÃ³re musisz przetwarzaÄ‡ w czasie rzeczywistym. Nie moÅ¼esz czekaÄ‡ na zatrzymanie linii produkcyjnej, aby przeprowadziÄ‡ analizÄ™ â€“ wszelkie pojawiajÄ…ce siÄ™ problemy powinny byÄ‡ rejestrowane natychmiast, aby szybko na nie reagowaÄ‡.

> Analiza strumieniowa to ciÄ…gÅ‚e przetwarzanie i analiza duÅ¼ych zbiorÃ³w danych w ruchu.

MoÅ¼na to porÃ³wnaÄ‡ do innych aspektÃ³w Big Data. Przetwarzanie wsadowe (batchowe) to przeciwieÅ„stwo przetwarzania strumieniowego â€“ najpierw gromadzisz duÅ¼e iloÅ›ci danych, a dopiero potem je analizujesz. OczywiÅ›cie, moÅ¼esz pobraÄ‡ caÅ‚e wideo przed obejrzeniem, ale czy miaÅ‚oby to sens?

IstniejÄ… sytuacje, w ktÃ³rych podejÅ›cie wsadowe jest wystarczajÄ…ce, ale juÅ¼ teraz widzisz, Å¼e przetwarzanie strumieniowe moÅ¼e dostarczyÄ‡ biznesowi dodatkowÄ… wartoÅ›Ä‡, ktÃ³rej trudno oczekiwaÄ‡ przy klasycznym przetwarzaniu wsadowym.

[ciekawe informacje](https://aws.amazon.com/streaming-data/)

### Analiza danych w czasie rzeczywistym a przetwarzanie strumienia zdarzeÅ„

Åatwo jest poÅ‚Ä…czyÄ‡ analizÄ™ w czasie rzeczywistym z analizÄ… strumieniowÄ… (lub przetwarzaniem strumienia zdarzeÅ„). ChoÄ‡ technologie analizy strumieniowej mogÄ… umoÅ¼liwiaÄ‡ analizÄ™ w czasie rzeczywistym, to nie to samo!

Analiza strumieniowa polega na przetwarzaniu danych w ruchu, natomiast analityka w czasie rzeczywistym odnosi siÄ™ do kaÅ¼dej metody przetwarzania danych, w ktÃ³rej opÃ³Åºnienie jest na tyle krÃ³tkie, Å¼e speÅ‚nia okreÅ›lone wymagania biznesowe dotyczÄ…ce â€czasu rzeczywistegoâ€.

Zazwyczaj systemy analizy w czasie rzeczywistym dzieli siÄ™ na twarde i miÄ™kkie systemy czasu rzeczywistego:

-	Twarde systemy czasu rzeczywistego (np. systemy sterujÄ…ce w samolotach) wymagajÄ… Å›cisÅ‚ego dotrzymania terminÃ³w â€“ kaÅ¼de opÃ³Åºnienie moÅ¼e mieÄ‡ katastrofalne skutki.
-	MiÄ™kkie systemy czasu rzeczywistego (np. stacje pogodowe) mogÄ… tolerowaÄ‡ pewne opÃ³Åºnienia, choÄ‡ w skrajnych przypadkach moÅ¼e to prowadziÄ‡ do utraty wartoÅ›ci danych.

Co wiÄ™cej, podczas gdy analiza strumieniowa zakÅ‚ada istnienie dedykowanej architektury strumieniowej, analiza w czasie rzeczywistym nie jest powiÄ…zana z Å¼adnÄ… konkretnÄ… architekturÄ….

Kluczowe jest to, Å¼e analityka w czasie rzeczywistym oznacza przetwarzanie danych w okresie, ktÃ³ry dana firma uznaje za â€czas rzeczywistyâ€ â€“ moÅ¼e to byÄ‡ zarÃ³wno kilka milisekund, jak i kilka sekund, w zaleÅ¼noÅ›ci od potrzeb biznesowych.

### Å¹rÃ³dÅ‚a danych przesyÅ‚anych strumieniowo obejmujÄ…:

- czujniki sprzÄ™tu,
- strumienie klikniÄ™Ä‡,
- Å›ledzenie lokalizacji,
- interakcjÄ™ z uÅ¼ytkownikiem,
- kanaÅ‚y mediÃ³w spoÅ‚ecznoÅ›ciowych,
- notowania gieÅ‚dowe,
- aktywnoÅ›Ä‡ w aplikacjach,
- inne.

Firmy wykorzystujÄ… analitykÄ™ strumieniowÄ… do wykrywania i interpretowania wzorcÃ³w, tworzenia wizualizacji, generowania spostrzeÅ¼eÅ„ i alertÃ³w oraz uruchamiania procesÃ³w w czasie rzeczywistym lub bliskim rzeczywistemu.

### Uzasadnienie biznesowe

Analityka sÅ‚uÅ¼y do identyfikowania istotnych wzorcÃ³w w danych i odkrywania nowej wiedzy â€“ zarÃ³wno w przypadku transmisji strumieniowych, jak i tradycyjnych analiz.

Jednak w dzisiejszym Å›wiecie natura â€znajdowania sensownych wzorcÃ³w w danychâ€ ulegÅ‚a zmianie, poniewaÅ¼ zmieniÅ‚ siÄ™ charakter samych danych. Ich szybkoÅ›Ä‡, objÄ™toÅ›Ä‡ i rÃ³Å¼norodnoÅ›Ä‡ eksplodowaÅ‚y.

Twitter generuje ponad 500 milionÃ³w tweetÃ³w dziennie, a wedÅ‚ug prognoz IDC do 2025 roku urzÄ…dzenia IoT bÄ™dÄ… w stanie wytworzyÄ‡ 79,4 zettabajta (ZB) danych. Trend ten wciÄ…Å¼ przyspiesza.



### PrzykÅ‚adowe biznesowe zastosowania

1. Dane z sensorÃ³w IoT i detekcja anomalii
2. Stock Trading (problemy regresyjne) - czas reagowania na zmiany i czas zakupy i sprzedaÅ¼y akcji. 
3. Clickstream for websites (problem klasyfikacji) - Å›ledzenie i analiza goÅ›ci na stronie serwisu internetowego - personalizacja strony i treÅ›ci. 

[8 najlepszych przykÅ‚adÃ³w analizy w czasie rzeczywistym](https://www.linkedin.com/pulse/8-best-examples-real-time-data-analytics-bernard-marr/)

[Biznesowe zastosowania](https://www.forbes.com/sites/forbestechcouncil/2021/10/26/how-to-build-a-strong-business-case-for-streaming-analytics/?sh=eee8eaa465d0)

## Definicje

### Zapoznaj siÄ™ z tematem [danych strumieniowych](https://medium.com/cuelogic-technologies/analyzing-data-streaming-using-spark-vs-kafka-bcfdc33ac828)

> **Definicja 1** â€“ *Zdarzenie* to wszystko, co moÅ¼na zaobserwowaÄ‡ w danym momencie czasu. Jest generowane jako bezpoÅ›redni skutek dziaÅ‚ania.  
>
> **Definicja 2** â€“ W kontekÅ›cie danych *zdarzenie* to **niezmienialny** rekord w strumieniu danych, zakodowany jako JSON, XML, CSV lub w formacie binarnym.  
>
> **Definicja 3** â€“ *CiÄ…gÅ‚y strumieÅ„ zdarzeÅ„* to nieskoÅ„czony zbiÃ³r pojedynczych zdarzeÅ„ uporzÄ…dkowanych w czasie, np. logi z urzÄ…dzeÅ„.  
>
> **Definicja 4** â€“ *StrumieÅ„ danych* to dane tworzone przyrostowo w czasie, generowane ze ÅºrÃ³deÅ‚ statycznych (baza danych, odczyt linii z pliku) lub dynamicznych (logi, sensory, funkcje).  
>
> **PrzedsiÄ™biorstwo to organizacja, ktÃ³ra generuje i odpowiada na ciÄ…gÅ‚y strumieÅ„ zdarzeÅ„.**

---

### Analityka strumieniowa  

**Analityka strumieniowa** (ang. _stream analytics_) nazywana jest rÃ³wnieÅ¼ **przetwarzaniem strumieniowym zdarzeÅ„** (ang. _event stream processing_) â€“ czyli przetwarzaniem duÅ¼ych iloÅ›ci danych juÅ¼ na etapie ich generowania.  

NiezaleÅ¼nie od zastosowanej technologii, wszystkie dane powstajÄ… jako **ciÄ…gÅ‚y strumieÅ„ zdarzeÅ„** â€“ obejmuje to m.in.:

- dziaÅ‚ania uÅ¼ytkownikÃ³w na stronach internetowych,  
- logi systemowe,  
- pomiary z sensorÃ³w.  

## Czas w analizie danych w czasie rzeczywistym

W przypadku przetwarzania wsadowego analizujemy dane historyczne, a czas uruchomienia procesu nie ma Å¼adnego zwiÄ…zku z momentem wystÄ…pienia analizowanych zdarzeÅ„.

Natomiast w przetwarzaniu strumieniowym wyrÃ³Å¼niamy dwie koncepcje czasu:

1.	Czas zdarzenia (event time) â€“ moment, w ktÃ³rym zdarzenie faktycznie miaÅ‚o miejsce.
2.	Czas przetwarzania (processing time) â€“ moment, w ktÃ³rym system przetwarza zdarzenie.

Idealne przetwarzanie danych

W idealnej sytuacji przetwarzanie nastÄ™puje natychmiast po wystÄ…pieniu zdarzenia:

<img alt="Batch Processing" src="../img/rys2_1.png" class="center" />

Rzeczywiste przetwarzanie danych

W praktyce przetwarzanie danych zawsze odbywa siÄ™ z pewnym opÃ³Åºnieniem, co jest widoczne jako punkty poniÅ¼ej linii idealnego przetwarzania (poniÅ¼ej przekÄ…tnej na wykresie).

<img alt="Batch Processing" src="../img/rys2_2.png" class="center" />

W aplikacjach przetwarzania strumieniowego istotna jest rÃ³Å¼nica miÄ™dzy czasem powstania zdarzenia a czasem jego przetwarzania. Do najczÄ™stszych przyczyn opÃ³ÅºnieÅ„ naleÅ¼Ä…:

- przesyÅ‚anie danych przez sieÄ‡,
- brak komunikacji miÄ™dzy urzÄ…dzeniem a sieciÄ….

PrzykÅ‚adem jest Å›ledzenie poÅ‚oÅ¼enia samochodu przez aplikacjÄ™ GPS â€“ przejazd przez tunel moÅ¼e spowodowaÄ‡ chwilowÄ… utratÄ™ danych.

ObsÅ‚uga opÃ³ÅºnieÅ„ w przetwarzaniu strumieniowym

OpÃ³Åºnienia w przetwarzaniu zdarzeÅ„ moÅ¼na obsÅ‚uÅ¼yÄ‡ na dwa sposoby:

1.	Monitorowanie liczby pominiÄ™tych zdarzeÅ„ i wyzwalanie alarmu w przypadku zbyt duÅ¼ej liczby odrzuceÅ„.
2.	Zastosowanie korekty za pomocÄ… watermarkingu, czyli dodatkowego mechanizmu uwzglÄ™dniajÄ…cego opÃ³Åºnione zdarzenia.

Proces przetwarzania zdarzeÅ„ w czasie rzeczywistym moÅ¼na przedstawiÄ‡ jako funkcjÄ™ schodkowÄ…:

<img alt="Batch Processing" src="../img/rys2_3.png" class="center" />

Nie wszystkie zdarzenia wnoszÄ… wkÅ‚ad do analizy â€“ niektÃ³re mogÄ… zostaÄ‡ odrzucone ze wzglÄ™du na zbyt duÅ¼e opÃ³Åºnienie.

Wykorzystanie watermarkingu pozwala na uwzglÄ™dnienie dodatkowego czasu na pojawienie siÄ™ opÃ³Åºnionych zdarzeÅ„. Proces ten obejmuje wszystkie zdarzenia powyÅ¼ej przerywanej linii. Mimo to nadal mogÄ… zdarzyÄ‡ siÄ™ przypadki, w ktÃ³rych niektÃ³re punkty zostanÄ… pominiÄ™te.

<img alt="Batch Processing" src="../img/rys2_4.png" class="center" />


Przedstawione na wykresach sytuacje jawnie wskazujÄ… dlaczego pojÄ™cie czasu jest istotnym czynnikiem i wymaga Å›cisÅ‚ego okreÅ›lenia juÅ¼ na poziomie definiowania potrzeb biznesowych.
Przypisywanie znacznikÃ³w czasu do danych (zdarzeÅ„) to trudne zadanie. 

## Okna czasowe w analizie strumieniowej 

W przetwarzaniu strumieniowym **okna czasowe** pozwalajÄ… na grupowanie danych w ograniczone czasowo segmenty, co umoÅ¼liwia analizÄ™ zdarzeÅ„ w okreÅ›lonych przedziaÅ‚ach czasowych. W zaleÅ¼noÅ›ci od zastosowania stosuje siÄ™ rÃ³Å¼ne typy okien, dostosowane do charakterystyki danych i wymagaÅ„ analitycznych.  

---

###  Okno rozÅ‚Ä…czne (_Tumbling Window_)  
Jest to okno o staÅ‚ej dÅ‚ugoÅ›ci, ktÃ³re **nie nakÅ‚ada siÄ™ na siebie** â€“ kaÅ¼de zdarzenie naleÅ¼y tylko do jednego okna.  

âœ… **Charakterystyka:** 

- StaÅ‚a dÅ‚ugoÅ›Ä‡ okna  
- Brak nakÅ‚adania siÄ™ na siebie  
- Idealne do podziaÅ‚u danych na rÃ³wne segmenty czasowe  

ğŸ“Œ **PrzykÅ‚ad:** Analiza liczby zamÃ³wieÅ„ w sklepie internetowym co 5 minut.  

<img alt="Tumbling Window" src="../img/rys2_5.png" class="center" />  

---

### Okno przesuwne (_Sliding Window_)  
Obejmuje wszystkie zdarzenia nastÄ™pujÄ…ce w okreÅ›lonym przedziale czasu, gdzie okno **przesuwa siÄ™ w sposÃ³b ciÄ…gÅ‚y**.  

âœ… **Charakterystyka:**

- KaÅ¼de zdarzenie moÅ¼e naleÅ¼eÄ‡ do kilku okien  
- Okno przesuwa siÄ™ o zadany interwaÅ‚  
- Przydatne do wykrywania trendÃ³w i anomalii  

ğŸ“Œ **PrzykÅ‚ad:** Åšledzenie Å›redniej temperatury w ciÄ…gu ostatnich 10 minut, aktualizowane co 2 minuty.  

<img alt="Sliding Window" src="../img/rys2_6.png" class="center" />  

---

### Okno skokowe (_Hopping Window_)  
Jest podobne do okna rozÅ‚Ä…cznego, ale pozwala na **nakÅ‚adanie siÄ™ okien** na siebie, dziÄ™ki czemu jedno zdarzenie moÅ¼e naleÅ¼eÄ‡ do kilku okien. Jest stosowane do wygÅ‚adzania danych.  

âœ… **Charakterystyka:** 

- StaÅ‚a dÅ‚ugoÅ›Ä‡ okna  
- MoÅ¼liwoÅ›Ä‡ nakÅ‚adania siÄ™ na siebie  
- Przydatne do redukcji szumÃ³w w danych  

ğŸ“Œ **PrzykÅ‚ad:** Analiza liczby odwiedzajÄ…cych stronÄ™ co 10 minut, ale aktualizowana co 5 minut, aby lepiej wychwytywaÄ‡ trendy.  

<img alt="Hopping Window" src="../img/rys2_7.png" class="center" />  

---

### Okno sesyjne (_Session Window_) 
Okno sesyjne grupuje zdarzenia na podstawie **okresÃ³w aktywnoÅ›ci** i zamyka siÄ™ po okreÅ›lonym czasie braku aktywnoÅ›ci.  

âœ… **Charakterystyka:**

- Dynamiczna dÅ‚ugoÅ›Ä‡ okna  
- Definiowane przez aktywnoÅ›Ä‡ uÅ¼ytkownika  
- Stosowane w analizie sesji uÅ¼ytkownikÃ³w  

ğŸ“Œ **PrzykÅ‚ad:** Analiza sesji uÅ¼ytkownikÃ³w na stronie internetowej â€“ sesja trwa tak dÅ‚ugo, jak dÅ‚ugo uÅ¼ytkownik wykonuje akcje, ale koÅ„czy siÄ™ po 15 minutach braku aktywnoÅ›ci.  
---

### Podsumowanie  
RÃ³Å¼ne rodzaje okien czasowych sÄ… stosowane w zaleÅ¼noÅ›ci od specyfiki danych i celÃ³w analizy. WybÃ³r odpowiedniego okna wpÅ‚ywa na dokÅ‚adnoÅ›Ä‡ wynikÃ³w i efektywnoÅ›Ä‡ systemu analitycznego.  

| Typ okna | Charakterystyka | Zastosowanie |
|----------|---------------|--------------|
| **RozÅ‚Ä…czne (_Tumbling_)** | StaÅ‚a dÅ‚ugoÅ›Ä‡, brak nakÅ‚adania | Raporty okresowe |
| **Przesuwne (_Sliding_)** | StaÅ‚a dÅ‚ugoÅ›Ä‡, nakÅ‚adajÄ…ce siÄ™ okna | Trendy, wykrywanie anomalii |
| **Skokowe (_Hopping_)** | StaÅ‚a dÅ‚ugoÅ›Ä‡, czÄ™Å›ciowe nakÅ‚adanie | WygÅ‚adzanie danych |
| **Sesyjne (_Session_)** | Dynamiczna dÅ‚ugoÅ›Ä‡, zaleÅ¼na od aktywnoÅ›ci | Analiza sesji uÅ¼ytkownikÃ³w |

KaÅ¼dy typ okna ma swoje unikalne zastosowania i pomaga w lepszej interpretacji danych strumieniowych. WybÃ³r wÅ‚aÅ›ciwej metody zaleÅ¼y od potrzeb biznesowych i charakterystyki analizowanych danych.


W analizie danych strumieniowych interpretacja czasu jest zÅ‚oÅ¼onym zagadnieniem, poniewaÅ¼:

1. RÃ³Å¼ne systemy majÄ… rÃ³Å¼ne zegary, co moÅ¼e prowadziÄ‡ do niespÃ³jnoÅ›ci,
2. Dane mogÄ… docieraÄ‡ z opÃ³Åºnieniem, co wymaga technik watermarkingu i okien czasowych,
3. RÃ³Å¼ne podejÅ›cia do analizy czasu zdarzenia i czasu przetwarzania wpÅ‚ywajÄ… na dokÅ‚adnoÅ›Ä‡ wynikÃ³w.