<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Wykład 4 – Analiza danych w czasie rzeczywistym</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-9a023c9ade86a60361e96e3e3f11bc54.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c4b40d80f3775827f3eec312850474a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="style.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Analiza danych w czasie rzeczywistym</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">222890-D</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./indexS.html"> 
<span class="menu-text">222890-S</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./sylabus.html"> 
<span class="menu-text">Sylabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./info.html"> 
<span class="menu-text">Narzędzia</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./ksiazki.html"> 
<span class="menu-text">Książki</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./wyklad1.html"> 
<span class="menu-text">Wykład 1</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./wyklad2.html"> 
<span class="menu-text">Wykład 2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./wyklad3.html"> 
<span class="menu-text">Wykład 3</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./wyklad4.html" aria-current="page"> 
<span class="menu-text">Wykład 4</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./wyklad5.html"> 
<span class="menu-text">Wykład 5</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title"><strong>Sections</strong></h2>
   
  <ul class="collapse">
  <li><a href="#historia-podejścia-do-architektury" id="toc-historia-podejścia-do-architektury" class="nav-link active" data-scroll-target="#historia-podejścia-do-architektury">Historia podejścia do architektury</a></li>
  <li><a href="#wpływ-technologii-na-systemy-informatyczne" id="toc-wpływ-technologii-na-systemy-informatyczne" class="nav-link" data-scroll-target="#wpływ-technologii-na-systemy-informatyczne">Wpływ technologii na systemy informatyczne</a></li>
  <li><a href="#mikrousługi-mikroserwisy-w-nowoczesnej-architekturze-it" id="toc-mikrousługi-mikroserwisy-w-nowoczesnej-architekturze-it" class="nav-link" data-scroll-target="#mikrousługi-mikroserwisy-w-nowoczesnej-architekturze-it">Mikrousługi (Mikroserwisy) w nowoczesnej architekturze IT</a></li>
  <li><a href="#przypadek-biznesowy-model-ml-jako-usługa" id="toc-przypadek-biznesowy-model-ml-jako-usługa" class="nav-link" data-scroll-target="#przypadek-biznesowy-model-ml-jako-usługa">Przypadek biznesowy: Model ML jako usługa</a></li>
  <li><a href="#jak-działa-api" id="toc-jak-działa-api" class="nav-link" data-scroll-target="#jak-działa-api">Jak działa API?</a></li>
  <li><a href="#publikujsubskrybuj" id="toc-publikujsubskrybuj" class="nav-link" data-scroll-target="#publikujsubskrybuj">Publikuj/Subskrybuj</a></li>
  <li><a href="#apache-kafka" id="toc-apache-kafka" class="nav-link" data-scroll-target="#apache-kafka">Apache Kafka</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Wykład 4</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="historia-podejścia-do-architektury" class="level2">
<h2 class="anchored" data-anchor-id="historia-podejścia-do-architektury">Historia podejścia do architektury</h2>
<p>Rozwój technologii, szczególnie przejście od <code>monolitów</code> do <code>mikroserwisów</code>, miał ogromny wpływ na współczesne systemy informatyczne. Monolityczne aplikacje, które były dominującym podejściem w przeszłości, stanowiły jedną, dużą jednostkę kodu. Takie podejście miało swoje zalety, takie jak prostota na początkowych etapach rozwoju systemu, ale także istotne wady, w tym trudności w skalowaniu, ograniczoną elastyczność i skomplikowaną konserwację.</p>
<p>W miarę jak technologia ewoluowała, pojawiły się <code>mikroserwisy</code> – podejście, które polega na dzieleniu aplikacji na mniejsze, niezależne usługi, z których każda odpowiada za określoną funkcjonalność. Przejście na mikroserwisy umożliwiło większą elastyczność, łatwiejsze skalowanie systemów oraz szybkie wdrażanie nowych funkcji. Ponadto każda usługa może być rozwijana, testowana i wdrażana niezależnie, co upraszcza zarządzanie kodem i zmniejsza ryzyko błędów.</p>
<p>Dzięki mikroserwisom organizacje mogą lepiej dostosować się do zmieniających się potrzeb biznesowych, poprawić dostępność systemów (poprzez izolowanie awarii do pojedynczych usług) oraz szybciej wprowadzać innowacje. Dodatkowo, mikroserwisy sprzyjają stosowaniu nowoczesnych metod takich jak konteneryzacja i chmurowe rozwiązania, co dodatkowo ułatwia zarządzanie infrastrukturą i pozwala na lepsze wykorzystanie zasobów.</p>
<p>Jednakże, mimo wielu korzyści, przejście do mikroserwisów wiąże się również z wyzwaniami, takimi jak:</p>
<ul>
<li>złożoność zarządzania komunikacją między usługami,</li>
<li>konieczność monitorowania i utrzymania większej liczby komponentów</li>
<li>zarządzanie transakcjami rozproszonymi.</li>
</ul>
<p>Wymaga to nowych narzędzi i podejść do zarządzania oraz wdrożenia kultury DevOps.</p>
<p>Wraz z rozwojem mikroserwisów, pojawiły się także nowe technologie, takie jak <code>serverless</code> i <code>konteneryzacja</code>, które stanowią naturalne rozszerzenie elastyczności systemów. Te technologie jeszcze bardziej zwiększają efektywność zarządzania i skalowania nowoczesnych aplikacji, stając się kluczowymi elementami w ekosystemie chmurowym.</p>
<section id="serverless" class="level3">
<h3 class="anchored" data-anchor-id="serverless">Serverless</h3>
<p>Serverless to model, w którym deweloperzy nie muszą zarządzać serwerami ani infrastrukturą. Zamiast tego, dostawcy chmurowi zajmują się całą infrastrukturą, a programiści koncentrują się jedynie na kodzie aplikacji. Kluczowym atutem tego podejścia jest jego skalowalność – aplikacje automatycznie skalują się w zależności od zapotrzebowania na zasoby. Systemy serverless pozwalają na dynamiczne uruchamianie i zatrzymywanie funkcji w odpowiedzi na konkretne zdarzenia, co prowadzi do optymalizacji kosztów (płacisz tylko za faktyczne wykorzystanie zasobów). To podejście ułatwia zarządzanie aplikacjami o zmiennym lub trudnym do przewidzenia ruchu.</p>
<p>Serverless jest także doskonałym uzupełnieniem dla mikroserwisów, pozwalając na uruchamianie niezależnych funkcji w odpowiedzi na różne zdarzenia, co daje jeszcze większą elastyczność. Może być wykorzystywane w takich zastosowaniach jak przetwarzanie danych w czasie rzeczywistym, obsługa API czy automatyzacja zadań.</p>
</section>
<section id="konteneryzacja" class="level3">
<h3 class="anchored" data-anchor-id="konteneryzacja">Konteneryzacja</h3>
<p>Konteneryzacja (np. przy użyciu Docker) to kolejny krok w kierunku zwiększenia elastyczności. Dzięki kontenerom, aplikacje oraz ich zależności są zapakowane w izolowane jednostki, które można uruchamiać w różnych środowiskach w sposób spójny i przewidywalny. Kontenery są lekkie, szybkie do uruchomienia i oferują łatwość w przenoszeniu aplikacji między różnymi platformami, co jest kluczowe w architekturach mikroserwisowych.</p>
<p>Konteneryzacja zyskuje na znaczeniu, szczególnie w połączeniu z narzędziami do zarządzania kontenerami, takimi jak Kubernetes, które automatycznie skalują aplikacje, monitorują ich stan, zapewniają wysoką dostępność oraz zarządzają ich cyklem życia. To podejście idealnie wspiera zarówno mikroserwisy, jak i serverless, umożliwiając łatwe wdrażanie, skalowanie i monitorowanie aplikacji.</p>
</section>
<section id="wspólny-cel-elastyczność" class="level3">
<h3 class="anchored" data-anchor-id="wspólny-cel-elastyczność">Wspólny Cel – Elastyczność</h3>
<p>Zarówno serverless, jak i konteneryzacja, stanowią dalszy krok w kierunku elastyczności, oferując możliwość szybkiej reakcji na zmieniające się warunki i zapotrzebowanie. Wspólnie z mikroserwisami tworzą nowoczesne podejście do architektury aplikacji, które pozwala na rozdzielenie odpowiedzialności, łatwiejsze skalowanie, dynamiczne dostosowywanie zasobów i lepsze wykorzystanie infrastruktury chmurowej.</p>
<p>Kombinacja tych technologii umożliwia firmom szybkie wdrażanie nowych funkcji, reagowanie na zmieniające się potrzeby użytkowników oraz minimalizowanie kosztów poprzez optymalne wykorzystanie zasobów, co jest szczególnie istotne w dzisiejszym, dynamicznie zmieniającym się środowisku technologicznym.</p>
</section>
</section>
<section id="wpływ-technologii-na-systemy-informatyczne" class="level2">
<h2 class="anchored" data-anchor-id="wpływ-technologii-na-systemy-informatyczne">Wpływ technologii na systemy informatyczne</h2>
<p>Komunikacja sieciowa, relacyjne bazy danych, rozwiązania chmurowe oraz Big Data znacząco zmieniły sposób budowania systemów informatycznych i wykonywania w nich pracy.</p>
<p>Podobnie, narzędzia do przekazu informacji – takie jak <strong>gazeta, radio, telewizja, internet, komunikatory i media społecznościowe</strong> – wpłynęły na interakcje międzyludzkie oraz struktury społeczne.<br>
Każde nowe medium technologiczne kształtuje sposób, w jaki ludzie korzystają z informatyki i postrzegają jej rolę w codziennym życiu.</p>
</section>
<section id="mikrousługi-mikroserwisy-w-nowoczesnej-architekturze-it" class="level2">
<h2 class="anchored" data-anchor-id="mikrousługi-mikroserwisy-w-nowoczesnej-architekturze-it">Mikrousługi (Mikroserwisy) w nowoczesnej architekturze IT</h2>
<p>Jednym z najpopularniejszych podejść do budowy systemów informatycznych jest <strong>koncepcja mikrousług (microservices)</strong>.<br>
Jest ona szeroko stosowana zarówno w <strong>tworzeniu oprogramowania</strong>, jak i w prowadzeniu firm opartych na analizie danych (<strong>Data-Driven</strong>).</p>
<section id="główne-zalety-mikroserwisów" class="level3">
<h3 class="anchored" data-anchor-id="główne-zalety-mikroserwisów">Główne zalety mikroserwisów:</h3>
<ul>
<li><strong>Wydajność</strong> – każda usługa realizuje jedno, dobrze określone zadanie (<em>“rób jedną rzecz, ale dobrze”</em>).</li>
<li><strong>Elastyczność</strong> – umożliwiają łatwe modyfikacje i skalowanie systemu.</li>
<li><strong>Przejrzystość architektury</strong> – system składa się z niewielkich, niezależnych modułów.</li>
</ul>
<p>Mikroserwisy można porównać do <strong>czystych funkcji</strong> w programowaniu funkcyjnym – każda usługa działa niezależnie i posiada jasno określone wejścia oraz wyjścia.</p>
<p>Aby umożliwić komunikację między mikroserwisami, często wykorzystuje się <strong>Application Programming Interfaces (API)</strong>, które pozwalają na wymianę danych i integrację różnych usług.</p>
</section>
<section id="przykład-api-w-mikroserwisach-python-fastapi" class="level3">
<h3 class="anchored" data-anchor-id="przykład-api-w-mikroserwisach-python-fastapi">Przykład API w mikroserwisach – Python &amp; FastAPI</h3>
<p>Poniżej znajduje się przykładowy mikroserwis REST API w <strong>Pythonie</strong> z użyciem <strong>FastAPI</strong>, który zwraca informacje o użytkownikach:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Przykładowe dane użytkowników</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>users <span class="op">=</span> {</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>: {<span class="st">"name"</span>: <span class="st">"Anna"</span>, <span class="st">"age"</span>: <span class="dv">28</span>},</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span>: {<span class="st">"name"</span>: <span class="st">"Piotr"</span>, <span class="st">"age"</span>: <span class="dv">35</span>},</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">3</span>: {<span class="st">"name"</span>: <span class="st">"Kasia"</span>, <span class="st">"age"</span>: <span class="dv">22</span>},</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/users/</span><span class="sc">{user_id}</span><span class="st">"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_user(user_id: <span class="bu">int</span>):</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Zwraca dane użytkownika na podstawie ID."""</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> users.get(user_id, {<span class="st">"error"</span>: <span class="st">"User not found"</span>})</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> uvicorn</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    uvicorn.run(app, host<span class="op">=</span><span class="st">"127.0.0.1"</span>, port<span class="op">=</span><span class="dv">8000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Jak to działa?</p>
<ol type="1">
<li>Uruchamiamy serwer FastAPI.</li>
<li>Możemy uzyskać dane użytkownika, wysyłając żądanie GET do <code>http://127.0.0.1:8000/users/1</code>.</li>
<li>API zwróci dane w formacie JSON, np.:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"name"</span><span class="fu">:</span> <span class="st">"Anna"</span><span class="fu">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"age"</span><span class="fu">:</span> <span class="dv">28</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="komunikacja-przez-api" class="level3">
<h3 class="anchored" data-anchor-id="komunikacja-przez-api">Komunikacja przez API</h3>
<p>Centralnym elementem architektury mikrousług jest wykorzystanie interfejsów <strong>API</strong> (<strong>Application Programming Interface</strong>).<br>
API umożliwia komunikację i integrację między różnymi mikroserwisami, podobnie jak strona internetowa komunikuje się z przeglądarką.<br>
Gdy odwiedzasz stronę internetową, serwer wysyła kod, który Twoja przeglądarka interpretuje i wyświetla jako stronę internetową.<br>
Podobnie działa API – wysyła odpowiedzi na zapytania klienta.</p>
</section>
</section>
<section id="przypadek-biznesowy-model-ml-jako-usługa" class="level2">
<h2 class="anchored" data-anchor-id="przypadek-biznesowy-model-ml-jako-usługa">Przypadek biznesowy: Model ML jako usługa</h2>
<p>Załóżmy, że pracujesz w firmie zajmującej się sprzedażą nieruchomości w <strong>Bostonie</strong>.<br>
Chcesz zwiększyć sprzedaż i poprawić jakość obsługi klientów poprzez nową aplikację mobilną, z której może korzystać nawet <strong>1 000 000 użytkowników jednocześnie</strong>.</p>
<p>Jednym z rozwiązań jest <strong>udostępnienie prognozy wartości domu</strong> w czasie rzeczywistym.<br>
Gdy użytkownik prosi o wycenę nieruchomości, aplikacja wysyła zapytanie do serwera, który przetwarza je za pomocą modelu <strong>Machine Learning (ML)</strong> i zwraca oszacowaną wartość.</p>
<section id="czym-jest-serwowanie-modelu-ml" class="level3">
<h3 class="anchored" data-anchor-id="czym-jest-serwowanie-modelu-ml">Czym jest serwowanie modelu ML?</h3>
<p>Trening dobrego modelu <strong>ML</strong> to dopiero <strong>pierwszy krok</strong> całego procesu.<br>
Aby model był użyteczny, musisz go <strong>udostępnić użytkownikom końcowym</strong>, np. w formie <strong>API</strong>.</p>
</section>
<section id="jak-to-zrobić" class="level3">
<h3 class="anchored" data-anchor-id="jak-to-zrobić">Jak to zrobić?</h3>
<ol type="1">
<li>Potrzebujesz:</li>
</ol>
<ul>
<li>wytrenowanego <strong>modelu ML</strong>,</li>
<li><strong>interpreter</strong> modelu (np. TensorFlow, Scikit-Learn, PyTorch),</li>
<li>danych wejściowych dla modelu.</li>
</ul>
<ol start="2" type="1">
<li><p>Kluczowe <strong>metryki</strong> jakości serwowania modelu:</p></li>
<li><p><strong>Czas odpowiedzi</strong> (latency),</p></li>
<li><p><strong>Koszt uruchomienia</strong> modelu (infrastruktura serwerowa),</p></li>
<li><p><strong>Liczba zapytań na sekundę</strong> (QPS – Queries Per Second).</p></li>
</ol>
<blockquote class="blockquote">
<p><strong>Udostępnianie danych między systemami</strong> zawsze było kluczowym wyzwaniem w tworzeniu oprogramowania.<br>
W obszarze tradycyjnego <strong>DevOps</strong> koncentrujemy się na infrastrukturze, a w <strong>MLOps</strong> – na wdrażaniu i utrzymaniu modeli uczenia maszynowego.</p>
</blockquote>
<p>Zbudowanie systemu przygotowanego do środowiska produkcyjnego jest bardziej skomplikowane niż wytrenowanie samego modelu:</p>
<ul>
<li>czyszczenie i załadowanie odpowiednich i zwalidowanych danych</li>
<li>Obliczenie zmiennych i ich serwowanie na właściwym środowisku</li>
<li>Serwowanie modelu w sposób najbardziej efektywny ze względu na koszty</li>
<li>Wersjonowanie, śledzenie i udostępnianie danych i modeli oraz innych artefaktów</li>
<li>Monitorowanie infrastruktury i modelu</li>
<li>Wdrożenie modelu na skalowalnej infrastrukturze</li>
<li>Automatyzacja procesu wdrażania i treningu</li>
</ul>
</section>
</section>
<section id="jak-działa-api" class="level2">
<h2 class="anchored" data-anchor-id="jak-działa-api">Jak działa API?</h2>
<p>Kiedy wywołasz <strong>interfejs API</strong>, serwer otrzymuje Twoje żądanie, przetwarza je i generuje odpowiedź.<br>
Jeśli wszystko działa poprawnie, otrzymasz wynik w formacie <strong>JSON</strong> lub <strong>XML</strong>.<br>
Jeśli wystąpi błąd, API zwróci <strong>kod błędu HTTP</strong> (np. 400 – nieprawidłowe żądanie, 500 – błąd serwera).</p>
<section id="kluczowe-zasady-rest-api" class="level3">
<h3 class="anchored" data-anchor-id="kluczowe-zasady-rest-api">Kluczowe zasady REST API:</h3>
<ul>
<li><p><strong>Klient-Serwer</strong> → Klient (np. aplikacja mobilna) wysyła żądanie HTTP do API hostowanego na serwerze, który zwraca odpowiedź.<br>
<em>Działa to identycznie jak przeglądarka internetowa, która wysyła żądanie do serwera WWW i otrzymuje stronę HTML.</em></p></li>
<li><p><strong>Bezstanowość</strong> → Każde żądanie klienta musi zawierać wszystkie niezbędne informacje do przetworzenia odpowiedzi,<br>
<em>API nie powinno przechowywać informacji o wcześniejszych żądaniach użytkownika.</em></p></li>
</ul>
</section>
<section id="przykład-api-serwujące-model-ml" class="level3">
<h3 class="anchored" data-anchor-id="przykład-api-serwujące-model-ml">Przykład: API serwujące model ML</h3>
<p>Poniżej znajduje się przykładowy <strong>serwis API</strong>, który udostępnia model <strong>ML</strong> do prognozowania ceny nieruchomości,<br>
z wykorzystaniem <strong>FastAPI</strong> oraz <strong>Scikit-Learn</strong>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Tworzymy API</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Wczytujemy wcześniej wytrenowany model ML (np. regresję liniową)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"model.pkl"</span>, <span class="st">"rb"</span>) <span class="im">as</span> f:</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> pickle.load(f)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/predict/"</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> predict_price(area: <span class="bu">float</span>, bedrooms: <span class="bu">int</span>, age: <span class="bu">int</span>):</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Prognoza ceny nieruchomości na podstawie cech:</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">    - area (powierzchnia w m²),</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">    - bedrooms (liczba sypialni),</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">    - age (wiek budynku w latach).</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    features <span class="op">=</span> np.array([[area, bedrooms, age]])</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    price <span class="op">=</span> model.predict(features)[<span class="dv">0</span>]</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"estimated_price"</span>: <span class="bu">round</span>(price, <span class="dv">2</span>)}</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> uvicorn</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    uvicorn.run(app, host<span class="op">=</span><span class="st">"127.0.0.1"</span>, port<span class="op">=</span><span class="dv">8000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="zapytanie---request" class="level3">
<h3 class="anchored" data-anchor-id="zapytanie---request">Zapytanie - Request</h3>
<ol type="1">
<li><p>Adres URL (np. <em>http://mydomain:8000/getapi?&amp;val1=43&amp;val2=3</em>) zawiera:</p>
<pre><code>- domenę, 
- port, 
- dodatkowe ścieżki, 
- zapytanie</code></pre></li>
<li><p>Metody HTTP:</p>
<pre><code>- GET, 
- POST</code></pre></li>
<li><p>Nagłówki HTTP zawierają:</p>
<pre><code>- informacje o autoryzacji, 
- cookies metadata</code></pre></li>
</ol>
<p>Cała informacja zawarta jest w <em>Content-Type: application/json, text … Accept: application/json, Authorization: Basic abase64string, Tokens</em> 4. Ciało zapytania</p>
<p>Najczęściej wybieranym formatem dla wymiany informacji między serwisami jest format <code>JavaScript Object Notation</code> (JSON). Przypomina on pythonowy obiekt słownika - “klucz”: “wartość”.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">"RAD"</span><span class="fu">:</span> <span class="dv">1</span><span class="fu">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="dt">"PTRATIO"</span><span class="fu">:</span> <span class="fl">15.3</span><span class="fu">,</span> <span class="dt">"INDUS"</span><span class="fu">:</span> <span class="fl">2.31</span><span class="fu">,</span> <span class="dt">"B"</span><span class="fu">:</span> <span class="fl">396.9</span><span class="fu">,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="dt">"ZN"</span><span class="fu">:</span> <span class="dv">18</span><span class="fu">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="dt">"DIS"</span><span class="fu">:</span> <span class="fl">4.09</span><span class="fu">,</span> <span class="dt">"CRIM"</span><span class="fu">:</span> <span class="dv">0</span><span class="er">.00632</span><span class="fu">,</span> <span class="dt">"RM"</span><span class="fu">:</span> <span class="fl">6.575</span><span class="fu">,</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="dt">"AGE"</span><span class="fu">:</span> <span class="fl">65.2</span><span class="fu">,</span> <span class="dt">"CHAS"</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span> <span class="dt">"NOX"</span><span class="fu">:</span> <span class="dv">0</span><span class="er">.</span><span class="dv">538</span><span class="fu">,</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="dt">"TAX"</span><span class="fu">:</span> <span class="dv">296</span><span class="fu">,</span> <span class="dt">"LSTAT"</span><span class="fu">:</span> <span class="fl">4.98</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="odpowiedź---response" class="level3">
<h3 class="anchored" data-anchor-id="odpowiedź---response">Odpowiedź - Response</h3>
<ol type="1">
<li>Treść odpowiedzi przekazywana jest razem z nagłówkiem oraz statusem:</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">200</span> OK</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Content-Encoding:</span> gzip</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Content-Type:</span> text/html<span class="kw">;</span> <span class="va">charset</span><span class="op">=</span>utf-8</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Date:</span> Mon, 18 Jul 2016 16:06:00 GMT Server: Apache</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="va">Path</span><span class="op">=</span>/<span class="kw">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li><p>np.: “<em>Content-Type” =&gt; ”application/json; charset=utf-8”, ”Server” =&gt; ”Genie/Julia/1.8.5</em>”</p></li>
<li><p>Treść (ciało) odpowiedzi:</p></li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">":input"</span><span class="fu">:{</span><span class="dt">"RAD"</span><span class="fu">:</span><span class="dv">1</span><span class="fu">,</span><span class="dt">"PTRATIO"</span><span class="fu">:</span><span class="fl">15.3</span><span class="fu">,</span><span class="dt">"INDUS"</span><span class="fu">:</span><span class="fl">2.31</span><span class="fu">,</span><span class="er">.....</span><span class="fu">}}</span><span class="er">,</span> <span class="fu">{</span><span class="dt">":prediction"</span><span class="fu">:</span><span class="ot">[</span><span class="fl">29.919737211857683</span><span class="ot">]</span><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li>HTTP status code:</li>
</ol>
<ul>
<li>200 OK - prawidłowe wykonanie zapytania,</li>
<li>40X Access Denied</li>
<li>50X Internal server error</li>
</ul>
<blockquote class="blockquote">
<p>Wyszukaj informacje czym jest <code>REST API</code>.</p>
</blockquote>
</section>
</section>
<section id="publikujsubskrybuj" class="level2">
<h2 class="anchored" data-anchor-id="publikujsubskrybuj">Publikuj/Subskrybuj</h2>
<p>System przesyłania wiadomości „Publikuj/Subskrybuj” ma kluczowe znaczenie dla aplikacji opartych na danych. <em>Komunikaty Pub/Sub</em> to wzorzec charakteryzujący się tym, że nadawca (publikujący) fragmentu danych (wiadomości) nie kieruje go wprost do odbiorcy. pub/sub to systemy, które często posiadają brokera czyli centralny punkt, w którym znajdują się wiadomości.</p>
</section>
<section id="apache-kafka" class="level2">
<h2 class="anchored" data-anchor-id="apache-kafka">Apache Kafka</h2>
<p>Na <a href="https://kafka.apache.org">witrynie Kafki</a> znajdziesz definicję:</p>
<section id="rozproszona-platforma-streamingowa" class="level3">
<h3 class="anchored" data-anchor-id="rozproszona-platforma-streamingowa">Rozproszona platforma streamingowa</h3>
<p><strong>Co to jest „platforma rozproszonego przesyłania strumieniowego”?</strong></p>
<p>Najpierw chcę przypomnieć, czym jest „strumień”. Strumienie to po prostu nieograniczone dane, dane, które nigdy się nie kończą. Ciągle ich przybywa i możesz przetwarzać je w czasie rzeczywistym.</p>
<p>A „rozproszone”? Rozproszony oznacza, że ​​Kafka działa w klastrze, a każdy węzeł w grupie nazywa się Brokerem. Ci brokerzy to po prostu serwery wykonujące kopię Apache Kafka.</p>
<p>Tak więc Kafka to zestaw współpracujących ze sobą maszyn, aby móc obsługiwać i przetwarzać nieograniczone dane w czasie rzeczywistym.</p>
<p>Brokerzy sprawiają, że jest niezawodny, skalowalny i odporny na błędy. Ale dlaczego panuje błędne przekonanie, że Kafka to kolejny „kolejkowy system przesyłania wiadomości”?</p>
<p>Aby odpowiedzieć na tę odpowiedź, musimy najpierw wyjaśnić, jak działa kolejkowe przesyłanie wiadomości.</p>
</section>
<section id="kolejkowy-system-przesyłania-wiadomości" class="level3">
<h3 class="anchored" data-anchor-id="kolejkowy-system-przesyłania-wiadomości">Kolejkowy system przesyłania wiadomości</h3>
<p>Przesyłanie wiadomości, to po prostu czynność wysyłania wiadomości z jednego miejsca do drugiego. Ma trzech głównych “aktorów”:</p>
<ul>
<li>Producent: Który tworzy i wysyła komunikaty do jednej lub więcej kolejek;</li>
<li>Kolejka: struktura danych bufora, która odbiera (od producentów) i dostarcza komunikaty (do konsumentów) w sposób FIFO (First-In-First-Out). Po otrzymaniu powiadomienia jest ono na zawsze usuwane z kolejki; nie ma szans na odzyskanie go;</li>
<li>Konsument: subskrybuje jedną lub więcej kolejek i otrzymuje ich wiadomości po opublikowaniu.</li>
</ul>
<p>I to jest to; tak działa przesyłanie wiadomości. Jak widać, nie ma tu nic o strumieniach, czasie rzeczywistym czy klastrach.</p>
</section>
<section id="architektura-apache-kafka" class="level3">
<h3 class="anchored" data-anchor-id="architektura-apache-kafka">Architektura Apache Kafka</h3>
<p>Więcej informacji na temat Kafki znajdziesz w tym <a href="https://www.cloudkarafka.com/blog/part1-kafka-for-beginners-what-is-apache-kafka.html">linku</a>.</p>
<p>Teraz, gdy rozumiemy podstawy przesyłania wiadomości, zagłębmy się w świat <strong>Apache Kafka</strong>.<br>
W Kafce mamy dwa kluczowe pojęcia: <strong>Producentów</strong> (<em>Producers</em>) i <strong>Konsumentów</strong> (<em>Consumers</em>),<br>
którzy działają w podobny sposób jak w klasycznych systemach kolejkowych, produkując i konsumując wiadomości.</p>
<p><br></p>
<p><img src="img/kafka1.png" class="center"></p>
<p>Jak widać, Kafka przypomina klasyczny system przesyłania wiadomości, jednak w odróżnieniu od tradycyjnych kolejek,<br>
zamiast pojęcia <strong>kolejki</strong> (<em>queue</em>) mamy <strong>Tematy</strong> (<em>Topics</em>).</p>
</section>
<section id="tematy-topics-i-partycje-partitions" class="level3">
<h3 class="anchored" data-anchor-id="tematy-topics-i-partycje-partitions">Tematy (Topics) i Partycje (Partitions)</h3>
<p><strong>Temat (Topic)</strong> to podstawowy kanał przesyłania danych w Kafce.<br>
Można go porównać do folderu, w którym przechowywane są wiadomości.</p>
<p>Każdy temat posiada jedną lub więcej <strong>partycji (Partitions)</strong> – podział ten wpływa na skalowalność i równoważenie obciążenia.<br>
Podczas tworzenia tematu określamy liczbę partycji.</p>
<section id="kluczowe-cechy-tematów-i-partycji" class="level4">
<h4 class="anchored" data-anchor-id="kluczowe-cechy-tematów-i-partycji">Kluczowe cechy tematów i partycji:</h4>
<ul>
<li><strong>Temat</strong> to logiczna jednostka, do której producenci wysyłają wiadomości, a konsumenci je odczytują.</li>
<li><strong>Partycja</strong> to fizyczny podział tematu. Można ją porównać do plików w folderze.</li>
<li><strong>Offset</strong> – każda wiadomość w partycji otrzymuje unikalny identyfikator (<em>offset</em>),<br>
który pozwala konsumentom śledzić, które wiadomości zostały już przetworzone.</li>
<li><strong>Kafka przechowuje wiadomości na dysku</strong>, dzięki czemu może je ponownie odczytać (w przeciwieństwie do klasycznych kolejek, gdzie wiadomość jest usuwana po przetworzeniu).</li>
<li><strong>Konsumenci odczytują wiadomości sekwencyjnie</strong>, od najstarszej do najnowszej.</li>
<li>W przypadku awarii konsument może wznowić przetwarzanie od ostatniego zapisanego <em>offsetu</em>.</li>
</ul>
<p><br></p>
<p><img src="img/kafka2.png" class="center"></p>
</section>
</section>
<section id="brokerzy-brokers-i-klaster-kafka" class="level3">
<h3 class="anchored" data-anchor-id="brokerzy-brokers-i-klaster-kafka">Brokerzy (Brokers) i Klaster Kafka</h3>
<p>Kafka działa w sposób <strong>rozproszony</strong> – oznacza to, że może składać się z wielu <strong>brokerów (Brokers)</strong>,<br>
które współpracują jako jeden klaster.</p>
<p><br></p>
<p><img src="img/kafka3.png" class="center"></p>
<section id="kluczowe-informacje-o-brokerach" class="level4">
<h4 class="anchored" data-anchor-id="kluczowe-informacje-o-brokerach">Kluczowe informacje o brokerach</h4>
<ul>
<li><strong>Broker</strong> to pojedynczy serwer w klastrze Kafki, odpowiedzialny za przechowywanie partycji tematów.</li>
<li>Każdy broker w klastrze ma unikalny identyfikator.</li>
<li>Aby zwiększyć dostępność i niezawodność, Kafka wykorzystuje <strong>replikację danych</strong>.</li>
<li><strong>Współczynnik replikacji</strong> określa, ile kopii danej partycji ma być przechowywane na różnych brokerach.</li>
<li>Jeśli temat ma <strong>trzy partycje</strong> i współczynnik replikacji równy <strong>trzy</strong>,<br>
oznacza to, że każda partycja zostanie powielona na trzech różnych brokerach.</li>
</ul>
<p>Liczba partycji powinna być dobrana w taki sposób, aby każdy broker miał co najmniej jedną partycję do obsługi.</p>
</section>
</section>
<section id="producenci-producers" class="level3">
<h3 class="anchored" data-anchor-id="producenci-producers">Producenci (Producers)</h3>
<p>W <strong>Kafka</strong> producenci to aplikacje lub usługi, które <strong>tworzą i wysyłają wiadomości</strong> do tematów.<br>
Działa to podobnie do systemów kolejkowych, z tą różnicą, że Kafka zapisuje wiadomości w partycjach.</p>
<section id="jak-kafka-przypisuje-wiadomości-do-partycji" class="level4">
<h4 class="anchored" data-anchor-id="jak-kafka-przypisuje-wiadomości-do-partycji">Jak Kafka przypisuje wiadomości do partycji?</h4>
<ul>
<li>Wiadomości są rozsyłane <strong>okrężnie</strong> (<em>round-robin</em>) do dostępnych partycji.</li>
<li>Możemy określić <strong>klucz wiadomości</strong>, a Kafka wyliczy jego <strong>hash</strong>,<br>
aby określić, do której partycji trafi wiadomość.</li>
<li><strong>Klucz wiadomości determinuje przypisanie do partycji</strong> – jeśli temat został już utworzony,<br>
liczba partycji nie może być zmieniona bez zakłócenia tego mechanizmu.</li>
</ul>
<p><strong>Przykład przypisania wiadomości do partycji:</strong> - Wiadomość <strong>01</strong> trafia do <strong>partycji 0</strong> tematu <strong>Topic_1</strong>. - Wiadomość <strong>02</strong> trafia do <strong>partycji 1</strong> tego samego tematu. - Kolejna wiadomość może ponownie trafić do <strong>partycji 0</strong>, jeśli stosujemy przypisanie <em>round-robin</em>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> kafka <span class="im">import</span> KafkaProducer</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tworzymy producenta Kafka</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>producer <span class="op">=</span> KafkaProducer(bootstrap_servers<span class="op">=</span><span class="st">"localhost:9092"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Wysyłamy wiadomość do tematu "real_estate"</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>topic <span class="op">=</span> <span class="st">"real_estate"</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>message <span class="op">=</span> <span class="st">b"Nowe mieszkanie na sprzeda</span><span class="er">ż</span><span class="st">"</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>producer.send(topic, message)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>producer.flush()</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Wiadomość wysłana do tematu '</span><span class="sc">{</span>topic<span class="sc">}</span><span class="ss">'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="konsumenci-consumers" class="level3">
<h3 class="anchored" data-anchor-id="konsumenci-consumers">Konsumenci (Consumers)</h3>
<p>Konsumenci w Kafce odczytują i przetwarzają wiadomości z tematów. Każdy konsument może należeć do grupy konsumentów (Consumer Group), co pozwala na równoległe przetwarzanie wiadomości. - Jeśli wielu konsumentów należy do tej samej grupy, Kafka równoważy obciążenie między nimi. - Jeśli jeden konsument przestanie działać, Kafka automatycznie przypisze jego partycje do innego aktywnego konsumenta.</p>
<p>Przykład konsumenta w Pythonie:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> kafka <span class="im">import</span> KafkaConsumer</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tworzymy konsumenta, który nasłuchuje temat "real_estate"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>consumer <span class="op">=</span> KafkaConsumer(<span class="st">"real_estate"</span>, bootstrap_servers<span class="op">=</span><span class="st">"localhost:9092"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Oczekiwanie na wiadomości..."</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> message <span class="kw">in</span> consumer:</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Otrzymano wiadomość: </span><span class="sc">{</span>message<span class="sc">.</span>value<span class="sc">.</span>decode()<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Innym ważnym pojęciem Kafki są „Grupy konsumentów”. Jest to bardzo ważne, gdy musimy skalować odczytywanie wiadomości. Staje się to bardzo kosztowne, gdy pojedynczy konsument musi czytać z wielu partycji, więc musimy zrównoważyć obciążenie między naszymi konsumentami, wtedy wchodzą grupy konsumentów.</p>
<p>Dane z jednego tematu będą równoważone obciążeniem między konsumentami, dzięki czemu możemy zagwarantować, że nasi konsumenci będą w stanie obsługiwać i przetwarzać dane. Ideałem jest posiadanie takiej samej liczby konsumentów w grupie, jaką mamy jako partycje w temacie, w ten sposób każdy konsument czyta tylko z jednego. Podczas dodawania konsumentów do grupy należy uważać, jeśli liczba konsumentów jest większa niż liczba partycji, niektórzy konsumenci nie będą czytać z żadnego tematu i pozostaną bezczynni.</p>
<p><br> <img src="img/kafka4.png" class="center"></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/sebkaz-teaching\.github\.io\/RTA_2025");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025, Sebastian Zając</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>